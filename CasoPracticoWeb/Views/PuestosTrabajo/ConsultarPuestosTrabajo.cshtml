@model IEnumerable<CasoPracticoWeb.Entities.PuestosTrabajoEnt>

@{
    ViewData["Title"] = "Consultar PuestosTrabajo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">


<div class="container-fluid">
    <div class="row mb-3">
        <div class="col-md-4">
            <label for="locationFilter">Filtrar por Ubicación:</label>
            <select id="locationFilter" class="form-control">
                <option value="">Todos</option>
                @foreach (var loc in Model.Select(m => m.ubicacion).Distinct())
                {
                    <option value="@loc">@loc</option>
                }
            </select>
        </div>
        <div class="col-md-4">
            <label for="companyFilter">Filtrar por Empresa:</label>
            <select id="companyFilter" class="form-control">
                <option value="">Todos</option>
                @foreach (var company in Model.Select(m => m.nombreEmpresa).Distinct())
                {
                    <option value="@company">@company</option>
                }
            </select>
        </div>
        <div class="col-md-4">
            <label for="jobTypeFilter">Filtrar por Tipo de Empleo:</label>
            <select id="jobTypeFilter" class="form-control">
                <option value="">Todos</option>
                @foreach (var type in Model.Select(m => m.tipoEmpleo).Distinct())
                {
                    <option value="@type">@type</option>
                }
            </select>
        </div>
    </div>
</div>
<section class="section__container job__container" id="job" >
    <a asp-controller="PuestosTrabajo" asp-action="RegistrarPuestosTrabajo" class="btn">Nueva Oferta</a>
    <div class="job__grid">
        @foreach (var item in Model) {
            <div class="job__card job-item"
                data-location="@item.ubicacion"
                data-company="@item.nombreEmpresa"
                data-jobtype="@item.tipoEmpleo">
                <div class="job__card__header">
                    <div>
                        <h5>@item.nombreEmpresa</h5>
                        <h6>@item.ubicacion</h6>
                    </div>
                </div>
                <h4>@item.titulo</h4>
              <p>
                @item.descripcion
              </p>
              <div class="job__card__footer">
                <span>@item.tipoEmpleo</span>
                <span>@item.salario</span>
                    <a asp-action="CrearUnaPostulacion" asp-controller="Postulaciones" asp-route-id="@item.idPuesto" class="btn btn-success" style="margin-left: 20px">Postular</a>
                    <a asp-action="ActualizarPuestosTrabajo" asp-controller="PuestosTrabajo" asp-route-id="@item.idEmpresa" class="btn btn-success" style="margin-left: 20px">Actualizar</a>
              </div>
            </div>
        }
        </div>
</section>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        var locationFilter = document.getElementById("locationFilter");
        var companyFilter = document.getElementById("companyFilter");
        var jobTypeFilter = document.getElementById("jobTypeFilter");

        locationFilter.addEventListener("change", filterJobs);
        companyFilter.addEventListener("change", filterJobs);
        jobTypeFilter.addEventListener("change", filterJobs);

        function filterJobs() {
            var locationValue = locationFilter.value.toLowerCase();
            var companyValue = companyFilter.value.toLowerCase();
            var jobTypeValue = jobTypeFilter.value.toLowerCase();

            var jobItems = document.querySelectorAll(".job-item");

            jobItems.forEach(function (item) {
                var itemLocation = item.getAttribute("data-location").toLowerCase();
                var itemCompany = item.getAttribute("data-company").toLowerCase();
                var itemJobType = item.getAttribute("data-jobtype").toLowerCase();

                var isLocationMatch = locationValue === "" || itemLocation.includes(locationValue);
                var isCompanyMatch = companyValue === "" || itemCompany.includes(companyValue);
                var isJobTypeMatch = jobTypeValue === "" || itemJobType.includes(jobTypeValue);

                if (isLocationMatch && isCompanyMatch && isJobTypeMatch) {
                    item.style.display = "block";
                } else {
                    item.style.display = "none";
                }
            });
        }
    });
</script>
